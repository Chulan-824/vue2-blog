(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-29225e6c"],{"159b":function(t,e,n){var i=n("da84"),r=n("fdbc"),o=n("17c2"),a=n("9112");for(var c in r){var s=i[c],l=s&&s.prototype;if(l&&l.forEach!==o)try{a(l,"forEach",o)}catch(u){l.forEach=o}}},"17c2":function(t,e,n){"use strict";var i=n("b727").forEach,r=n("a640"),o=n("ae40"),a=r("forEach"),c=o("forEach");t.exports=a&&c?[].forEach:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0)}},"1dde":function(t,e,n){var i=n("d039"),r=n("b622"),o=n("2d00"),a=r("species");t.exports=function(t){return o>=51||!i((function(){var e=[],n=e.constructor={};return n[a]=function(){return{foo:1}},1!==e[t](Boolean).foo}))}},2386:function(t,e,n){"use strict";n("b2f6")},4160:function(t,e,n){"use strict";var i=n("23e7"),r=n("17c2");i({target:"Array",proto:!0,forced:[].forEach!=r},{forEach:r})},"65f0":function(t,e,n){var i=n("861d"),r=n("e8b5"),o=n("b622"),a=o("species");t.exports=function(t,e){var n;return r(t)&&(n=t.constructor,"function"!=typeof n||n!==Array&&!r(n.prototype)?i(n)&&(n=n[a],null===n&&(n=void 0)):n=void 0),new(void 0===n?Array:n)(0===e?0:e)}},"8fc4":function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"Message"},[n("Nav"),n("div",{staticClass:"main"},[n("div",{staticClass:"content"},[n("article",[n("section",[n("h2",[t._v("留言板")]),n("p",[t._v("沟通交流，拉近你我！")]),n("RichText",{on:{Sub:t.handleSubmit}})],1),n("section",[n("ul",t._l(t.commentList,(function(e,i){return n("li",{key:e._id},[n("div",{staticClass:"comment-parent"},[n("div",{staticClass:"p-img",style:{backgroundImage:"url("+e.user.photo+")"}}),n("div",{staticClass:"p-info"},[n("div",{staticClass:"p-name"},[t._v(t._s(e.user.user))]),n("div",{staticClass:"p-content",domProps:{innerHTML:t._s(e.content)}}),n("div",{staticClass:"p-time"},[n("span",[t._v(t._s(t._f("getTime")(e.date)))]),n("a",{on:{click:function(e){return t.replyClick(i)}}},[t._v(" "+t._s(e.reply.lastIndexArr[0]===i&&void 0===e.reply.lastIndexArr[1]?"收起":"回复")+" ")])])])]),t._l(e.children,(function(r,o){return n("div",{key:r.date+Math.random(),staticClass:"comment-child"},[n("div",{staticClass:"c-img",style:{backgroundImage:"url("+r.user.photo+")"}}),n("div",{staticClass:"c-info"},[n("div",{staticClass:"c-name"},[n("span",{staticClass:"name"},[t._v(t._s(r.user.user))]),t._v("回复"),n("span",{staticClass:"name"},[t._v(t._s(r.reUser))]),n("span",[t._v(t._s(r.content))])]),n("div",{staticClass:"c-time"},[n("span",[t._v(t._s(t._f("getTime")(r.date)))]),n("a",{on:{click:function(e){return t.replyClick(i,o)}}},[t._v(" "+t._s(e.reply.lastIndexArr[0]===i&&e.reply.lastIndexArr[1]===o?"收起":"回复")+" ")])])])])})),n("div",{class:["comment-reply",{show:e.reply.ifShow}]},[n("textarea",{directives:[{name:"model",rawName:"v-model",value:e.reply.content,expression:"item.reply.content"}],attrs:{placeholder:"回复【"+e.reply.reUser+"】："},domProps:{value:e.reply.content},on:{input:function(n){n.target.composing||t.$set(e.reply,"content",n.target.value)}}}),n("button",{staticClass:"layui-btn layui-btn-xs",attrs:{type:"button"},on:{click:function(e){return t.childCommit(i)}}},[t._v("提交")])])],2)})),0)])])])])],1)},r=[],o=(n("99af"),n("4160"),n("159b"),n("216c")),a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("textarea",{staticStyle:{display:"none"},attrs:{id:"demo"}}),n("button",{staticClass:"layui-btn",attrs:{type:"button"},on:{click:t.handleClick}},[t._v("提交留言")])])},c=[],s={name:"RichText",data:function(){return{layedit:null,index:0}},methods:{handleClick:function(){this.$emit("Sub",this.layedit.getContent(this.index))}},mounted:function(){var t=this;layui.use("layedit",(function(){t.layedit=layui.layedit,t.index=t.layedit.build("demo",{tool:["face"]})}))}},l=s,u=n("2877"),d=Object(u["a"])(l,a,c,!1,null,"3d3e273c",null),f=d.exports,m=n("365c"),h=m["a"].postIfLogin,p=m["a"].commitMessage,v=m["a"].getMessageList,y=m["a"].commitChildMessage;function g(t){return(t<10?"0":"")+t}var b={name:"Message",data:function(){return{commentList:[],skip:0,limit:0,ifLoding:!1}},filters:{getTime:function(t){var e=new Date(t),n=g(e.getFullYear()),i=g(e.getMonth()+1),r=g(e.getDate()),o=g(e.getHours()),a=g(e.getMinutes()),c=g(e.getSeconds());return"".concat(n,"年").concat(i,"月").concat(r,"日 ").concat(o,":").concat(a,":").concat(c)}},methods:{handleSubmit:function(t){h().then((function(e){e.data.userInfo?p({user:e.data.userInfo._id,content:t}).then((function(t){layer.msg("留言成功",{icon:1}),setTimeout((function(){window.location.reload()}),1e3)})).catch((function(){layer.msg("服务器错误~请稍后再试",{icon:2})})):layer.msg("请先登录",{icon:2})})).catch((function(){layer.msg("服务器错误~请稍后再试",{icon:2})}))},replyClick:function(t,e){if(void 0!==t){var n=this.commentList[t];this.commentList[t].reply.reUser=void 0!==e?this.commentList[t].children[e].user.user:this.commentList[t].user.user,t===n.reply.lastIndexArr[0]&&e===n.reply.lastIndexArr[1]?(n.reply.ifShow=!1,n.reply.lastIndexArr=[]):(n.reply.ifShow=!0,n.reply.lastIndexArr=[t,e])}},childCommit:function(t){var e=this;h().then((function(n){n.data.userInfo?y({parentId:e.commentList[t]._id,user:n.data.userInfo._id,content:e.commentList[t].reply.content,reUser:e.commentList[t].reply.reUser}).then((function(t){t.data.code?layer.msg(t.data.msg,{icon:2}):(layer.msg("评论成功",{icon:1}),setTimeout((function(){window.location.reload()}),1e3))})):layer.msg("请先登录",{icon:2})})).catch((function(){layer.msg("服务器错误~请稍后再试",{icon:2})}))},handleScroll:function(){var t=this;if(!this.ifLoding){var e=document.documentElement.offsetHeight,n=document.documentElement.scrollTop,i=document.documentElement.clientHeight;n+i>=e-200&&(this.ifLoding=!0,this.getMessageList((function(){t.ifLoding=!1})))}},getMessageList:function(t){var e=this;this.limit+=5,v(this.skip,this.limit).then((function(n){if(0===n.data.code){var i=n.data.data;i.forEach((function(t){t.reply={user:"",content:"",reUser:"",date:"",ifShow:!1,lastIndexArr:[]}})),e.commentList=i}t&&t()})).catch((function(){t&&t()}))}},components:{Nav:o["a"],RichText:f},created:function(){this.getMessageList()},mounted:function(){window.addEventListener("scroll",this.handleScroll)},destroyed:function(){window.removeEventListener("scroll",this.handleScroll)}},_=b,x=(n("2386"),Object(u["a"])(_,i,r,!1,null,"f0aa1846",null));e["default"]=x.exports},"99af":function(t,e,n){"use strict";var i=n("23e7"),r=n("d039"),o=n("e8b5"),a=n("861d"),c=n("7b0b"),s=n("50c4"),l=n("8418"),u=n("65f0"),d=n("1dde"),f=n("b622"),m=n("2d00"),h=f("isConcatSpreadable"),p=9007199254740991,v="Maximum allowed index exceeded",y=m>=51||!r((function(){var t=[];return t[h]=!1,t.concat()[0]!==t})),g=d("concat"),b=function(t){if(!a(t))return!1;var e=t[h];return void 0!==e?!!e:o(t)},_=!y||!g;i({target:"Array",proto:!0,forced:_},{concat:function(t){var e,n,i,r,o,a=c(this),d=u(a,0),f=0;for(e=-1,i=arguments.length;e<i;e++)if(o=-1===e?a:arguments[e],b(o)){if(r=s(o.length),f+r>p)throw TypeError(v);for(n=0;n<r;n++,f++)n in o&&l(d,f,o[n])}else{if(f>=p)throw TypeError(v);l(d,f++,o)}return d.length=f,d}})},b2f6:function(t,e,n){},b727:function(t,e,n){var i=n("0366"),r=n("44ad"),o=n("7b0b"),a=n("50c4"),c=n("65f0"),s=[].push,l=function(t){var e=1==t,n=2==t,l=3==t,u=4==t,d=6==t,f=7==t,m=5==t||d;return function(h,p,v,y){for(var g,b,_=o(h),x=r(_),C=i(p,v,3),w=a(x.length),L=0,E=y||c,k=e?E(h,w):n||f?E(h,0):void 0;w>L;L++)if((m||L in x)&&(g=x[L],b=C(g,L,_),t))if(e)k[L]=b;else if(b)switch(t){case 3:return!0;case 5:return g;case 6:return L;case 2:s.call(k,g)}else switch(t){case 4:return!1;case 7:s.call(k,g)}return d?-1:l||u?u:k}};t.exports={forEach:l(0),map:l(1),filter:l(2),some:l(3),every:l(4),find:l(5),findIndex:l(6),filterOut:l(7)}},e8b5:function(t,e,n){var i=n("c6b6");t.exports=Array.isArray||function(t){return"Array"==i(t)}}}]);
//# sourceMappingURL=chunk-29225e6c.f26de608.js.map