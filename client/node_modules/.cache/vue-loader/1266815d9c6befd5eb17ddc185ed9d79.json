{"remainingRequest":"F:\\前端\\前端框架班教室\\vue\\vue教室课堂代码\\blog\\client\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!F:\\前端\\前端框架班教室\\vue\\vue教室课堂代码\\blog\\client\\src\\views\\Message\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"F:\\前端\\前端框架班教室\\vue\\vue教室课堂代码\\blog\\client\\src\\views\\Message\\index.vue","mtime":1586184269605},{"path":"F:\\前端\\前端框架班教室\\vue\\vue教室课堂代码\\blog\\client\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1610873814290},{"path":"F:\\前端\\前端框架班教室\\vue\\vue教室课堂代码\\blog\\client\\node_modules\\babel-loader\\lib\\index.js","mtime":1610873812815},{"path":"F:\\前端\\前端框架班教室\\vue\\vue教室课堂代码\\blog\\client\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1610873814290},{"path":"F:\\前端\\前端框架班教室\\vue\\vue教室课堂代码\\blog\\client\\node_modules\\vue-loader\\lib\\index.js","mtime":1610873867195}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBOYXYgZnJvbSAiLi4vLi4vY29tcG9uZW50cy9OYXYiOwppbXBvcnQgUmljaFRleHQgZnJvbSAiLi4vLi4vY29tcG9uZW50cy9SaWNoVGV4dCI7CmltcG9ydCByZXF1ZXN0IGZyb20gIi4uLy4uL2FwaSIKCmNvbnN0IHBvc3RJZkxvZ2luID0gcmVxdWVzdC5wb3N0SWZMb2dpbjsKY29uc3QgY29tbWl0TWVzc2FnZSA9IHJlcXVlc3QuY29tbWl0TWVzc2FnZTsKY29uc3QgZ2V0TWVzc2FnZUxpc3QgPSByZXF1ZXN0LmdldE1lc3NhZ2VMaXN0Owpjb25zdCBjb21taXRDaGlsZE1lc3NhZ2UgPSByZXF1ZXN0LmNvbW1pdENoaWxkTWVzc2FnZTsKCmZ1bmN0aW9uIHRvVHdvKG51bSl7CiAgcmV0dXJuIChudW08MTA/IjAiOiIiKSArIG51bTsKfQoKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICJNZXNzYWdlIiwKICBkYXRhKCl7CiAgICByZXR1cm4gewogICAgICBjb21tZW50TGlzdCA6IFtdLAoKICAgICAgc2tpcCA6IDAsCiAgICAgIGxpbWl0IDogMCwKICAgICAgaWZMb2RpbmcgOiBmYWxzZQogICAgfQogIH0sCiAgZmlsdGVyczp7CiAgICBnZXRUaW1lKHZhbCl7CiAgICAgIGxldCBkYXRlID0gbmV3IERhdGUodmFsKTsKCiAgICAgIGxldCBZWSA9IHRvVHdvKGRhdGUuZ2V0RnVsbFllYXIoKSksCiAgICAgICAgTU0gPSB0b1R3byhkYXRlLmdldE1vbnRoKCkrMSksCiAgICAgICAgREQgPSB0b1R3byhkYXRlLmdldERhdGUoKSksCiAgICAgICAgaCA9IHRvVHdvKGRhdGUuZ2V0SG91cnMoKSksCiAgICAgICAgbSA9IHRvVHdvKGRhdGUuZ2V0TWludXRlcygpKSwKICAgICAgICBzID0gdG9Ud28oZGF0ZS5nZXRTZWNvbmRzKCkpOwoKICAgICAgcmV0dXJuIGAke1lZfeW5tCR7TU195pyIJHtERH3ml6UgJHtofToke219OiR7c31gOwogICAgfQogIH0sCiAgbWV0aG9kcyA6IHsKICAgIGhhbmRsZVN1Ym1pdCh2YWwpewoKICAgICAgcG9zdElmTG9naW4oKQogICAgICAgIC50aGVuKHJlcz0+ewogICAgICAgICAgaWYgKHJlcy5kYXRhLnVzZXJJbmZvKSB7CiAgICAgICAgICAgIC8v55m76ZmG5LqG77yM5bCx5Y+R6YCB5pWw5o2u5Yiw5pWw5o2u5bqTIC0tIOaJp+ihjOeVmeiogOaPkOS6pOeahGFqYXgKICAgICAgICAgICAgY29tbWl0TWVzc2FnZSh7CiAgICAgICAgICAgICAgdXNlciA6IHJlcy5kYXRhLnVzZXJJbmZvLl9pZCwKICAgICAgICAgICAgICBjb250ZW50IDogdmFsCiAgICAgICAgICAgIH0pLnRoZW4ocmVzPT57CiAgICAgICAgICAgICAgbGF5ZXIubXNnKCfnlZnoqIDmiJDlip8nLCB7aWNvbjogMX0pOwogICAgICAgICAgICAgIHNldFRpbWVvdXQoKCk9PnsKICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTsKICAgICAgICAgICAgICB9LDEwMDApOwogICAgICAgICAgICB9KS5jYXRjaCgoKT0+ewogICAgICAgICAgICAgIGxheWVyLm1zZygn5pyN5Yqh5Zmo6ZSZ6K+vfuivt+eojeWQjuWGjeivlScsIHtpY29uOiAyfSk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAvL+acqueZu+W9lQogICAgICAgICAgICBsYXllci5tc2coJ+ivt+WFiOeZu+W9lScsIHtpY29uOiAyfSk7CiAgICAgICAgICB9CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKCk9PnsKICAgICAgICAgIC8v5pyN5Yqh5Ye66ZSZCiAgICAgICAgICBsYXllci5tc2coJ+acjeWKoeWZqOmUmeivr37or7fnqI3lkI7lho3or5UnLCB7aWNvbjogMn0pOwogICAgICAgIH0pOwoKICAgIH0sCiAgICByZXBseUNsaWNrKHBJbmRleCxjSW5kZXgpewoKICAgICAgaWYgKHBJbmRleCA9PT0gdW5kZWZpbmVkKXJldHVybjsKCiAgICAgIGxldCBwYXJlbnREYXRhID0gdGhpcy5jb21tZW50TGlzdFtwSW5kZXhdOwoKCiAgICAgIC8v5pS55Y+YcGxhY2Vob2xkZXLnmoTlhoXlrrkKICAgICAgaWYgKGNJbmRleCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgLy/lm57lpI3nmoTlrZDor4TorroKICAgICAgICB0aGlzLmNvbW1lbnRMaXN0W3BJbmRleF0ucmVwbHkucmVVc2VyID0gdGhpcy5jb21tZW50TGlzdFtwSW5kZXhdLmNoaWxkcmVuW2NJbmRleF0udXNlci51c2VyOwogICAgICB9ZWxzZXsKICAgICAgICAvL+WbnuWkjeeahOeItuivhOiuugogICAgICAgIHRoaXMuY29tbWVudExpc3RbcEluZGV4XS5yZXBseS5yZVVzZXIgPSB0aGlzLmNvbW1lbnRMaXN0W3BJbmRleF0udXNlci51c2VyOwogICAgICB9CgoKICAgICAgLy/kuKTmrKHngrnnmoTlkIzkuIDkuKoKICAgICAgLy/kuI3mmK/lkIzkuIDkuKoKICAgICAgaWYgKChwSW5kZXggPT09IHBhcmVudERhdGEucmVwbHkubGFzdEluZGV4QXJyWzBdICYmIGNJbmRleCA9PT0gcGFyZW50RGF0YS5yZXBseS5sYXN0SW5kZXhBcnJbMV0pKSB7CiAgICAgICAgcGFyZW50RGF0YS5yZXBseS5pZlNob3cgPSBmYWxzZTsKICAgICAgICBwYXJlbnREYXRhLnJlcGx5Lmxhc3RJbmRleEFycj1bXTsKICAgICAgfWVsc2V7CiAgICAgICAgcGFyZW50RGF0YS5yZXBseS5pZlNob3cgPSB0cnVlOwogICAgICAgIHBhcmVudERhdGEucmVwbHkubGFzdEluZGV4QXJyPVtwSW5kZXgsY0luZGV4XTsKICAgICAgfQogICAgfSwKICAgIGNoaWxkQ29tbWl0KHBJbmRleCl7CiAgICAgIC8v5Yik5pat55m75b2VCiAgICAgIHBvc3RJZkxvZ2luKCkKICAgICAgICAudGhlbihyZXM9PnsKICAgICAgICAgIGlmIChyZXMuZGF0YS51c2VySW5mbykgewogICAgICAgICAgICAvL+eZu+mZhuS6hu+8jOWwseWPkemAgeaVsOaNruWIsOaVsOaNruW6kyAtLSDmiafooYznlZnoqIDmj5DkuqTnmoRhamF4CiAgICAgICAgICAgIGNvbW1pdENoaWxkTWVzc2FnZSh7CiAgICAgICAgICAgICAgcGFyZW50SWQgOiB0aGlzLmNvbW1lbnRMaXN0W3BJbmRleF0uX2lkLAogICAgICAgICAgICAgIHVzZXI6cmVzLmRhdGEudXNlckluZm8uX2lkLAogICAgICAgICAgICAgIGNvbnRlbnQ6IHRoaXMuY29tbWVudExpc3RbcEluZGV4XS5yZXBseS5jb250ZW50LAogICAgICAgICAgICAgIHJlVXNlciA6IHRoaXMuY29tbWVudExpc3RbcEluZGV4XS5yZXBseS5yZVVzZXIKICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAudGhlbihyZXM9PnsKICAgICAgICAgICAgICAgIGlmIChyZXMuZGF0YS5jb2RlKSB7CiAgICAgICAgICAgICAgICAgIC8vY29kZeS4jeS4ujDvvIzor4TorrrlpLHotKUKICAgICAgICAgICAgICAgICAgbGF5ZXIubXNnKHJlcy5kYXRhLm1zZywge2ljb246IDJ9KTsKICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAvL2NvZGXkuLow77yM6K+E6K665oiQ5YqfCiAgICAgICAgICAgICAgICAgIGxheWVyLm1zZygn6K+E6K665oiQ5YqfJywge2ljb246IDF9KTsKICAgICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKT0+ewogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTsKICAgICAgICAgICAgICAgICAgfSwxMDAwKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KQogICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgIC8v5pyq55m75b2VCiAgICAgICAgICAgIGxheWVyLm1zZygn6K+35YWI55m75b2VJywge2ljb246IDJ9KTsKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoKT0+ewogICAgICAgICAgLy/mnI3liqHlh7rplJkKICAgICAgICAgIGxheWVyLm1zZygn5pyN5Yqh5Zmo6ZSZ6K+vfuivt+eojeWQjuWGjeivlScsIHtpY29uOiAyfSk7CiAgICAgICAgfSk7CiAgICB9LAoKICAgIGhhbmRsZVNjcm9sbCgpewogICAgICBpZiAodGhpcy5pZkxvZGluZylyZXR1cm47CgogICAgICAvL+aWh+aho+mrmAogICAgICBsZXQgYyA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5vZmZzZXRIZWlnaHQ7CiAgICAgIC8v5rua5Yqo6auYCiAgICAgIGxldCBhID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRvcDsKICAgICAgLy/lj6/op4bljLrpq5gKICAgICAgbGV0IGIgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0OwoKICAgICAgaWYgKGEgKyBiID49IGMgLSAyMDApIHsKICAgICAgICB0aGlzLmlmTG9kaW5nID0gdHJ1ZTsKICAgICAgICB0aGlzLmdldE1lc3NhZ2VMaXN0KCgpPT57CiAgICAgICAgICB0aGlzLmlmTG9kaW5nID0gZmFsc2U7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBnZXRNZXNzYWdlTGlzdChjYil7CiAgICAgIHRoaXMubGltaXQgKz0gNTsKICAgICAgZ2V0TWVzc2FnZUxpc3QodGhpcy5za2lwLHRoaXMubGltaXQpCiAgICAgICAgLnRoZW4ocmVzPT57CiAgICAgICAgICBpZiAocmVzLmRhdGEuY29kZSA9PT0gMCkgewogICAgICAgICAgICBsZXQgZGF0YSA9IHJlcy5kYXRhLmRhdGE7CiAgICAgICAgICAgIGRhdGEuZm9yRWFjaChpdGVtPT57CiAgICAgICAgICAgICAgaXRlbS5yZXBseT17CiAgICAgICAgICAgICAgICB1c2VyIDogIiIsLy9pZAogICAgICAgICAgICAgICAgY29udGVudCA6ICIiLC8v5Zue5aSN5YaF5a65CiAgICAgICAgICAgICAgICByZVVzZXIgOiAiIiwvL+Wtl+espuS4sgogICAgICAgICAgICAgICAgZGF0ZSA6ICIiLC8v5pel5pyfCiAgICAgICAgICAgICAgICBpZlNob3cgOiBmYWxzZSwKICAgICAgICAgICAgICAgIGxhc3RJbmRleEFyciA6IFtdCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdGhpcy5jb21tZW50TGlzdCA9IGRhdGE7CiAgICAgICAgICB9CiAgICAgICAgICBjYiAmJiBjYigpOwogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKCgpPT57CiAgICAgICAgICBjYiAmJiBjYigpOwogICAgICAgIH0pCiAgICB9CiAgfSwKICBjb21wb25lbnRzOnsKICAgIE5hdixSaWNoVGV4dAogIH0KCiAgLGNyZWF0ZWQoKSB7CiAgICB0aGlzLmdldE1lc3NhZ2VMaXN0KCk7CiAgfQoKICAsbW91bnRlZCgpIHsKICAgIC8v5Y+R6YCB56ys5LiA5qyh6K+35rGCCgoKICAgIC8v55uR5ZCs5rua5Yqo5LqL5Lu2CiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigic2Nyb2xsIix0aGlzLmhhbmRsZVNjcm9sbCk7CiAgfQogICxkZXN0cm95ZWQoKSB7CiAgICAvL+enu+mZpOebkeWQrOa7muWKqOS6i+S7tgogICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoInNjcm9sbCIsdGhpcy5oYW5kbGVTY3JvbGwpOwogIH0KfQoK"},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwDA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/Message","sourcesContent":["<template>\r\n  <div class=\"Message\">\r\n    <Nav></Nav>\r\n    <div class=\"main\">\r\n      <div class=\"content\">\r\n        <article>\r\n          <section>\r\n            <h2>留言板</h2>\r\n            <p>沟通交流，拉近你我！</p>\r\n            <RichText @Sub=\"handleSubmit\"></RichText>\r\n          </section>\r\n          <section>\r\n            <ul>\r\n              <li v-for=\"(item,index) in commentList\" :key=\"item._id\">\r\n                <div class=\"comment-parent\">\r\n                  <div class=\"p-img\" :style=\"{backgroundImage:'url('+item.user.photo+')'}\"></div>\r\n                  <div class=\"p-info\">\r\n                    <div class=\"p-name\">{{item.user.user}}</div>\r\n                    <div class=\"p-content\" v-html=\"item.content\"></div>\r\n                    <div class=\"p-time\">\r\n                      <span>{{item.date | getTime}}</span>\r\n                      <a @click=\"replyClick(index)\">\r\n                        {{(item.reply.lastIndexArr[0]===index && item.reply.lastIndexArr[1]===undefined)?\"收起\":\"回复\"}}\r\n                      </a>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n                <div class=\"comment-child\" v-for=\"(childItem,childIndex) in item.children\"  :key=\"childItem.date + Math.random()\">\r\n                  <div class=\"c-img\"  :style=\"{backgroundImage:'url('+childItem.user.photo+')'}\"></div>\r\n                  <div class=\"c-info\">\r\n                    <div class=\"c-name\">\r\n                      <span class=\"name\">{{childItem.user.user}}</span>回复<span class=\"name\">{{childItem.reUser}}</span>\r\n                      <span>{{childItem.content}}</span>\r\n                    </div>\r\n                    <div class=\"c-time\">\r\n                      <span>{{childItem.date | getTime}}</span>\r\n                      <a @click=\"replyClick(index,childIndex)\">\r\n                        {{(item.reply.lastIndexArr[0]===index && item.reply.lastIndexArr[1]===childIndex)?\"收起\":\"回复\"}}\r\n                      </a>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n                <div :class=\"['comment-reply',{'show':item.reply.ifShow}]\">\r\n                  <textarea v-model=\"item.reply.content\" :placeholder=\"'回复【'+item.reply.reUser+'】：'\"></textarea>\r\n                  <button @click=\"childCommit(index)\" type=\"button\" class=\"layui-btn layui-btn-xs\">提交</button>\r\n                </div>\r\n              </li>\r\n            </ul>\r\n          </section>\r\n        </article>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n  import Nav from \"../../components/Nav\";\r\n  import RichText from \"../../components/RichText\";\r\n  import request from \"../../api\"\r\n\r\n  const postIfLogin = request.postIfLogin;\r\n  const commitMessage = request.commitMessage;\r\n  const getMessageList = request.getMessageList;\r\n  const commitChildMessage = request.commitChildMessage;\r\n\r\n  function toTwo(num){\r\n    return (num<10?\"0\":\"\") + num;\r\n  }\r\n\r\n  export default {\r\n    name: \"Message\",\r\n    data(){\r\n      return {\r\n        commentList : [],\r\n\r\n        skip : 0,\r\n        limit : 0,\r\n        ifLoding : false\r\n      }\r\n    },\r\n    filters:{\r\n      getTime(val){\r\n        let date = new Date(val);\r\n\r\n        let YY = toTwo(date.getFullYear()),\r\n          MM = toTwo(date.getMonth()+1),\r\n          DD = toTwo(date.getDate()),\r\n          h = toTwo(date.getHours()),\r\n          m = toTwo(date.getMinutes()),\r\n          s = toTwo(date.getSeconds());\r\n\r\n        return `${YY}年${MM}月${DD}日 ${h}:${m}:${s}`;\r\n      }\r\n    },\r\n    methods : {\r\n      handleSubmit(val){\r\n\r\n        postIfLogin()\r\n          .then(res=>{\r\n            if (res.data.userInfo) {\r\n              //登陆了，就发送数据到数据库 -- 执行留言提交的ajax\r\n              commitMessage({\r\n                user : res.data.userInfo._id,\r\n                content : val\r\n              }).then(res=>{\r\n                layer.msg('留言成功', {icon: 1});\r\n                setTimeout(()=>{\r\n                  window.location.reload();\r\n                },1000);\r\n              }).catch(()=>{\r\n                layer.msg('服务器错误~请稍后再试', {icon: 2});\r\n              });\r\n\r\n            }else{\r\n              //未登录\r\n              layer.msg('请先登录', {icon: 2});\r\n            }\r\n          })\r\n          .catch(()=>{\r\n            //服务出错\r\n            layer.msg('服务器错误~请稍后再试', {icon: 2});\r\n          });\r\n\r\n      },\r\n      replyClick(pIndex,cIndex){\r\n\r\n        if (pIndex === undefined)return;\r\n\r\n        let parentData = this.commentList[pIndex];\r\n\r\n\r\n        //改变placeholder的内容\r\n        if (cIndex !== undefined) {\r\n          //回复的子评论\r\n          this.commentList[pIndex].reply.reUser = this.commentList[pIndex].children[cIndex].user.user;\r\n        }else{\r\n          //回复的父评论\r\n          this.commentList[pIndex].reply.reUser = this.commentList[pIndex].user.user;\r\n        }\r\n\r\n\r\n        //两次点的同一个\r\n        //不是同一个\r\n        if ((pIndex === parentData.reply.lastIndexArr[0] && cIndex === parentData.reply.lastIndexArr[1])) {\r\n          parentData.reply.ifShow = false;\r\n          parentData.reply.lastIndexArr=[];\r\n        }else{\r\n          parentData.reply.ifShow = true;\r\n          parentData.reply.lastIndexArr=[pIndex,cIndex];\r\n        }\r\n      },\r\n      childCommit(pIndex){\r\n        //判断登录\r\n        postIfLogin()\r\n          .then(res=>{\r\n            if (res.data.userInfo) {\r\n              //登陆了，就发送数据到数据库 -- 执行留言提交的ajax\r\n              commitChildMessage({\r\n                parentId : this.commentList[pIndex]._id,\r\n                user:res.data.userInfo._id,\r\n                content: this.commentList[pIndex].reply.content,\r\n                reUser : this.commentList[pIndex].reply.reUser\r\n              })\r\n                .then(res=>{\r\n                  if (res.data.code) {\r\n                    //code不为0，评论失败\r\n                    layer.msg(res.data.msg, {icon: 2});\r\n                  }else{\r\n                    //code为0，评论成功\r\n                    layer.msg('评论成功', {icon: 1});\r\n                    setTimeout(()=>{\r\n                      window.location.reload();\r\n                    },1000);\r\n                  }\r\n                })\r\n            }else{\r\n              //未登录\r\n              layer.msg('请先登录', {icon: 2});\r\n            }\r\n          })\r\n          .catch(()=>{\r\n            //服务出错\r\n            layer.msg('服务器错误~请稍后再试', {icon: 2});\r\n          });\r\n      },\r\n\r\n      handleScroll(){\r\n        if (this.ifLoding)return;\r\n\r\n        //文档高\r\n        let c = document.documentElement.offsetHeight;\r\n        //滚动高\r\n        let a = document.documentElement.scrollTop;\r\n        //可视区高\r\n        let b = document.documentElement.clientHeight;\r\n\r\n        if (a + b >= c - 200) {\r\n          this.ifLoding = true;\r\n          this.getMessageList(()=>{\r\n            this.ifLoding = false;\r\n          });\r\n        }\r\n      },\r\n      getMessageList(cb){\r\n        this.limit += 5;\r\n        getMessageList(this.skip,this.limit)\r\n          .then(res=>{\r\n            if (res.data.code === 0) {\r\n              let data = res.data.data;\r\n              data.forEach(item=>{\r\n                item.reply={\r\n                  user : \"\",//id\r\n                  content : \"\",//回复内容\r\n                  reUser : \"\",//字符串\r\n                  date : \"\",//日期\r\n                  ifShow : false,\r\n                  lastIndexArr : []\r\n                }\r\n              });\r\n              this.commentList = data;\r\n            }\r\n            cb && cb();\r\n          })\r\n          .catch(()=>{\r\n            cb && cb();\r\n          })\r\n      }\r\n    },\r\n    components:{\r\n      Nav,RichText\r\n    }\r\n\r\n    ,created() {\r\n      this.getMessageList();\r\n    }\r\n\r\n    ,mounted() {\r\n      //发送第一次请求\r\n\r\n\r\n      //监听滚动事件\r\n      window.addEventListener(\"scroll\",this.handleScroll);\r\n    }\r\n    ,destroyed() {\r\n      //移除监听滚动事件\r\n      window.removeEventListener(\"scroll\",this.handleScroll);\r\n    }\r\n  }\r\n\r\n</script>\r\n\r\n<style scoped lang=\"less\">\r\n  .Message{\r\n    >.main{\r\n      box-sizing: border-box;\r\n      max-width: 1360px;\r\n      padding: 70px 50px;\r\n      margin: 0 auto;\r\n      >.content{\r\n        width: 100%;\r\n        background-color: #fff;\r\n        >article{\r\n          section:nth-child(1){\r\n            box-sizing: border-box;\r\n            width: 100%;\r\n            padding: 20px 15px;\r\n            >h2{\r\n              font-weight: 700;\r\n              font-size: 2rem;\r\n              text-align: center;\r\n            }\r\n            >p{\r\n              font-size: 1.25rem;\r\n              margin: 1rem 0;\r\n              text-align: center;\r\n            }\r\n          }\r\n          section:nth-child(2){\r\n            box-sizing: border-box;\r\n            padding: 20px 15px;\r\n            width: 100%;\r\n            >ul{\r\n              width: 100%;\r\n              >li{\r\n                padding: 20px 0;\r\n                border-bottom: 1px dotted #333;\r\n                .comment-parent{\r\n                  display: flex;\r\n                  .p-img{\r\n                    width: 45px;\r\n                    height: 45px;\r\n                    background-position: center center;\r\n                    background-size: cover;\r\n                  }\r\n                  .p-info{\r\n                    flex: 1;\r\n                    padding-bottom: 20px;\r\n                    border-bottom: 1px dotted #aaa;\r\n                    .p-name{\r\n                      overflow: hidden;\r\n                      color: #01aaed;\r\n                    }\r\n                    .p-content{\r\n                      padding: 2px 0 5px 0;\r\n                      min-height: 30px;\r\n                      font-size: 12px;\r\n                      word-break: break-all;\r\n                    }\r\n                    .p-time{\r\n                      font-size: 12px;\r\n                      color: #999;\r\n                      span{\r\n                        padding-left: 15px;\r\n                        padding-right: 15px;\r\n                      }\r\n                      a{\r\n                        color: blue;\r\n                        cursor: pointer;\r\n                      }\r\n                    }\r\n                  }\r\n                }\r\n                .comment-child{\r\n                  display: flex;\r\n                  box-sizing: border-box;\r\n                  width: 100%;\r\n                  padding-left: 50px;\r\n                  padding-top: 20px;\r\n                  .c-img{\r\n                    width: 45px;\r\n                    height: 45px;\r\n                    background-position: center center;\r\n                    background-size: cover;\r\n                  }\r\n                  .c-info{\r\n                    flex: 1;\r\n                    font-size: 12px;\r\n                    .c-name{\r\n                      .name{\r\n                        color: #01aaed;\r\n                        margin: 0 5px;\r\n                      }\r\n                    }\r\n                    .c-time{\r\n                      padding-left: 20px;\r\n                      padding-top: 5px;\r\n                      span{\r\n                        margin-right: 10px;\r\n                      }\r\n                      a{\r\n                        cursor: pointer;\r\n                        color: blue;\r\n                      }\r\n                    }\r\n                  }\r\n                }\r\n                .comment-reply{\r\n                  overflow: hidden;\r\n                  box-sizing: border-box;\r\n                  width: 100%;\r\n                  height: 0;\r\n                  padding-left: 50px;\r\n                  padding-top: 10px;\r\n                  transition: height .3s;\r\n                  &.show{\r\n                    height: 100px;\r\n                  }\r\n                  textarea{\r\n                    display: block;\r\n                    width: 100%;\r\n                    height: 60px;\r\n                    border-color: #aaa;\r\n                    padding: 10px;\r\n                    box-sizing: border-box;\r\n                    resize: none;\r\n                  }\r\n                  button{\r\n                    margin-top: 8px;\r\n                    display: block;\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n</style>"]}]}